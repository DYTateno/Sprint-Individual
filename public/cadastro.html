<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Cadastro</title>
</head>
<style>
    /* FONTE:VIGA */
    @import url('https://fonts.googleapis.com/css2?family=Anton+SC&family=Danfo&family=Viga&display=swap');
    /*FONTE: ANTON SC*/
    @import url('https://fonts.googleapis.com/css2?family=Anton+SC&family=Danfo&display=swap');
    /*FONTE: GABARITO*/
    @import url('https://fonts.googleapis.com/css2?family=Anton+SC&family=Danfo&family=Gabarito:wght@400..900&family=Viga&display=swap');
    /* FONTE: LEXEND */
    @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap');
    /* FONTE: NEW AMSTERDAM */
    @import url('https://fonts.googleapis.com/css2?family=New+Amsterdam&display=swap');
    /* FONTE: SUSE */
    @import url('https://fonts.googleapis.com/css2?family=Anton+SC&family=Danfo&family=Gabarito:wght@400..900&family=SUSE:wght@100..800&family=Viga&display=swap');
</style>

<body>
    <div class="siteTop">
        <div class="Header">
            <a href=".//index.html"><img class="home" src=".//imgs/home.png" alt=""></a>
            </select>
            <div id="loginCadastro">

                <!-- botão login -->
                <span class="login" onclick="Cadastro()"><a style="color: greenyellow; text-decoration: none;"
                        href=".//Cadastro.html">Cadastre-se</a></span>

                <!-- botão cadastro -->
                <span class="cadastro" onclick="Login()"><a style="color: greenyellow; text-decoration: none;"
                        href=".//Login.html">Login</a></span>

            </div>

        </div>
        <div class="Cadastro">

            <div class="UserInputs">
                <div id="aviso" style="display: none;">Por favor preencha todos os dados antes de continuar</div>
                <span class="Texto">Cadastro</span>
                <div id="interativos">

                    <input id="ipt_Nome" placeholder="Nome" class="inputSpace" type="text">
                    <input id="ipt_Email" placeholder="Email" class="inputSpace" type="text">
                    <input oninput="seguro()" id="ipt_Senha" placeholder="Senha" class="inputSpace" type="password">
                    <input id="ipt_Confirme" placeholder="Confirme sua senha" class="inputSpace"
                        type="password">
                    <button onclick="cadastrar()" class="button"> Cadastrar</button>

                </div>
                <div id="segurancaSenha">
                    <div id="seguranca">Segurança da senha:</div>
                    <div id="requisitosSenha">
                        <div class="requisitoComprimento">Comprimento mínimo (8 caracteres)</div>
                        <div class="requisitoUpperLower">Possui letras maiúsculas e minúsculas</div>
                        <div class="requisitoNumero">Possui números</div>
                        <div class="requisitoEspecial">Possui caracteres especiais (ex.: !, @, #, $)</div>
                    </div>
                </div>


            </div>
        </div>

</body>

</html>

<script>

    function seguro() {
        
        var nomeVar = ipt_Nome.value;
        var emailVar = ipt_Email.value;
        var senhaVar = ipt_Senha.value;
        var confirmeSenha = false

        var toUpperCase = senhaVar.toUpperCase();
        var toLowerCase = senhaVar.toLowerCase();
        var Comprimento = senhaVar.length;

        var especiais = "!@#$%¨&*()_+:;"
        var temEspeciais = false

        var numeros = "1234567890"
        var temNumeros = false

        var Minusculo = false
        var Maiusculo = false

        var senhaUpper = senhaVar.toUpperCase()
        var senhaLower = senhaVar.toLowerCase()

        for (var i = 0; i < numeros.length; i++) {
            if (senhaVar.includes(numeros[i])) {
                temNumeros = true
            }
        }

        for (var i = 0; i < especiais.length; i++) {
            if (senhaVar.includes(especiais[i])) {
                temEspeciais = true
            }
        }
        for (var i = 0; i < Comprimento; i++) {
            if (senhaVar == senhaVar) {
                confirmeSenha = true
            }
        }
        if(Comprimento > 1){
        for (var i = 0; i < Comprimento; i++) {
            if (senhaVar.includes(senhaUpper[i])) {
                Maiusculo = true
            }
        }
        for (var i = 0; i < Comprimento; i++) {
            if (senhaVar.includes(senhaLower[i])) {
                Minusculo = true
            }
        }
        }
        
        for (var i = 0; i < especiais.length; i++) {
    if (senhaVar.includes(especiais[i])) {
        temEspeciais = true;
        break; 
    }
}

        if (Maiusculo == true && Minusculo == true) {
            document.querySelector(".requisitoUpperLower").style.color = "green";
        } else {
            document.querySelector(".requisitoUpperLower").style.color = "red";
            return false
        }

        if (Comprimento < 8) {
            document.querySelector(".requisitoComprimento").style.color = "red";
            return false
        } else {
            document.querySelector(".requisitoComprimento").style.color = "green";
            
        }
        if (temEspeciais == false) {
            document.querySelector(".requisitoEspecial").style.color = "red";
            return false
        } else {
            document.querySelector(".requisitoEspecial").style.color = "green";
            
        }
        if (temNumeros == true) {
            document.querySelector(".requisitoNumero").style.color = "green";
        } else {
            document.querySelector(".requisitoNumero").style.color = "red";
            return false
        }

        // if (Comprimento > 0) {
        //     if (senhaVar == ) {
        //         aviso.innerHTML = "Por favor preencha todos os dados antes de continuar";
        //     } else {

        //         aviso.innerHTML = "As senhas não conferem";
        //     }
        // } else { aviso.innerHTML = "Por favor preencha todos os dados antes de continuar"; }
        return true
    }


    function cadastrar() {
        // aguardar();

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo

        if(!seguro()){
            return
        }

        var nomeVar = ipt_Nome.value;
        var emailVar = ipt_Email.value;
        var senhaVar = ipt_Senha.value;
        var confirmeSenha = `a`

        var toUpperCase = senhaVar.toUpperCase();
        var toLowerCase = senhaVar.toLowerCase();
        var Comprimento = Comprimento;


        if (nomeVar == "" || emailVar == "" || senhaVar == "" || confirmeSenha == "") {
            aviso.style.display = "block";
            return false;
        }
        else {
            aviso.style.display = "none";

            // ;
           
        }

        // // Verificando se há algum campo em branco
        // if (
        //   nomeVar == "" ||
        //   emailVar == "" ||
        //   senhaVar == "" ||
        //   confirmacaoSenhaVar == "" ||
        //   codigoVar == ""
        // ) {
        //   aviso.style.display = "block";
        //   mensagem_erro.innerHTML =
        //     "(Mensagem de erro para todos os campos em branco)";

        //   ;
        //   return false;
        // } else {
        //   setInterval(sumirMensagem, 5000);
        // }

        // Verificando se o código de ativação é de alguma empresa cadastrada
        // for (let i = 0; i < listaEmpresasCadastradas.length; i++) {
        //   if (listaEmpresasCadastradas[i].codigo_ativacao == codigoVar) {
        //     idEmpresaVincular = listaEmpresasCadastradas[i].id
        //     console.log("Código de ativação válido.");
        //     break;
        //   } else {
        //     aviso.style.display = "block";
        //     mensagem_erro.innerHTML = "(Mensagem de erro para código inválido)";
        //     ;
        //   }
        // }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                // idEmpresaVincularServer: idEmpresaVincular
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    aviso.style.display = "block";


                    aviso.innerHTML = `<span style="color: green;">Cadastro realizado com sucesso</span>`

                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000");

                    limparFormulario();
                    ;
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                ;
            });

        return false;
    }


    function sumirMensagem() {
        aviso.style.display = "none";
    }




</script>